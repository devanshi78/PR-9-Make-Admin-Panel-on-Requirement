<%- include('../partials/header.ejs') %>

<style>
    /* General Styling */
    .product-wrapper {
        background: #fff;
        border-radius: 14px;
        padding: 25px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    }

    .product-img {
        border-radius: 14px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    }

    h2.fw-bold {
        font-size: 28px;
        line-height: 1.3;
    }

    .tag-box {
        background: #eef4ff;
        color: #3b5bdb;
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 14px;
        display: inline-block;
        margin-bottom: 10px;
    }

    .action-buttons a {
        margin-right: 10px;
    }

    /* Specs */
    .spec-item {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid #eee;
        font-size: 15px;
    }
    .spec-item:last-child {
        border-bottom: none;
    }

    /* Ratings */
    .rating-stars i {
        color: #ffc107;
        font-size: 22px;
    }

    /* Review Box */
    .review-box {
        background: #f6f7fb;
        padding: 15px;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
    }

    /* Description */
    .desc-text {
        font-size: 15px;
        line-height: 1.6;
    }
</style>

<div class="page-wrapper">
    <div class="container-fluid">

        <!-- PRODUCT TOP -->
        <div class="product-wrapper mb-4">
            <div class="row">
                <div class="col-md-6">
                    <img src="/<%= product.image %>" class="img-fluid product-img">
                </div>

                <div class="col-md-6">
                    <h2 class="fw-bold"><%= product.name %></h2>

                    <h3 class="text-success fw-bold">₹<%= product.price %></h3>

                    <div class="tag-box">
                        <%= product.category.name %>
                    </div>

                    <p style="font-size: 15px;">
                        <strong>Subcategory:</strong> <%= product.subcategory.name %><br>
                        <strong>Extra Category:</strong> <%= product.extracategory.name %>
                    </p>

                    <!-- DESCRIPTION WITH READ MORE -->
                    <div class="mt-3">
                        <h5 class="fw-bold mb-2">Description</h5>

                        <% if (product.description && product.description.length > 150) { %>

                            <p id="shortDesc" class="desc-text" style="display:block;">
                                <%= product.description.substring(0, 150) %>...
                                <a href="javascript:void(0)" id="readMoreBtn">Read More</a>
                            </p>

                            <p id="fullDesc" class="desc-text" style="display:none;">
                                <%= product.description %>
                                <br>
                                <a href="javascript:void(0)" id="readLessBtn">Read Less</a>
                            </p>

                        <% } else { %>

                            <p class="desc-text"><%= product.description %></p>

                        <% } %>
                    </div>

                    <div class="action-buttons mt-3">
                        <a href="/product/edit/<%= product.id %>" class="btn btn-warning px-4">Edit</a>
                        <a href="/product/delete/<%= product.id %>" class="btn btn-danger px-4">Delete</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- RATING SECTION -->
        <div class="product-wrapper mb-4">
            <h4 class="fw-bold mb-3">Ratings</h4>

            <div class="rating-stars mb-2">
                <% for (let i = 1; i <= 5; i++) { %>
                    <i class="fa fa-star <%= i <= product.rating ? 'text-warning' : 'text-secondary' %>"></i>
                <% } %>
            </div>

            <p class="mb-0" style="font-size: 15px;">Average Rating:
                <strong><%= product.rating || 0 %>/5</strong>
            </p>
        </div>

        <!-- COMMENTS SECTION -->
        <div class="product-wrapper mb-4">
            <h4 class="fw-bold mb-3">Customer Reviews</h4>

            <% if (product.comments && product.comments.length > 0) { %>

                <% product.comments.forEach(comment => { %>
                    <div class="review-box mb-3">
                        <strong><%= comment.user %></strong>
                        <div class="rating-stars mb-1">
                            <% for (let i = 1; i <= 5; i++) { %>
                                <i class="fa fa-star <%= i <= comment.rating ? 'text-warning' : 'text-secondary' %>"></i>
                            <% } %>
                        </div>
                        <p class="mb-0 desc-text"><%= comment.text %></p>
                    </div>
                <% }) %>

            <% } else { %>
                <p class="text-muted">No reviews yet.</p>
            <% } %>

            <form action="/product/add-comment/<%= product.id %>" method="POST" class="mt-3">
                <h5 class="fw-bold">Add a Review:</h5>

                <select name="rating" class="form-control mb-2" required>
                    <option value="">Select Rating</option>
                    <option value="5">⭐⭐⭐⭐⭐ - Excellent</option>
                    <option value="4">⭐⭐⭐⭐ - Good</option>
                    <option value="3">⭐⭐⭐ - Average</option>
                    <option value="2">⭐⭐ - Poor</option>
                    <option value="1">⭐ - Very Bad</option>
                </select>

                <textarea name="comment" class="form-control mb-2" placeholder="Write your review..." required></textarea>

                <button class="btn btn-primary px-4">Submit Review</button>
            </form>
        </div>

    </div>
</div>

<!-- READ MORE / READ LESS SCRIPT -->
<script>
    const readMoreBtn = document.getElementById("readMoreBtn");
    const readLessBtn = document.getElementById("readLessBtn");

    if (readMoreBtn) {
        readMoreBtn.addEventListener("click", function () {
            document.getElementById("shortDesc").style.display = "none";
            document.getElementById("fullDesc").style.display = "block";
        });
    }

    if (readLessBtn) {
        readLessBtn.addEventListener("click", function () {
            document.getElementById("shortDesc").style.display = "block";
            document.getElementById("fullDesc").style.display = "none";
        });
    }
</script>

<%- include('../partials/footer.ejs') %>